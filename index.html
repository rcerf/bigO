<!DOCTYPE html>  
<html lang="en">
<head> 
<title>BigO Quizlet</title>
  
    <link href="http://netdna.bootstrapcdn.com/bootstrap/3.1.0/css/bootstrap.min.css" rel="stylesheet">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <script src="http://static.stackmob.com/js/json2-min.js"></script>
    <script src="http://static.stackmob.com/js/underscore-1.4.4-min.js"></script>
    <script src="http://static.stackmob.com/js/backbone-1.0.0-min.js"></script>
    
    <script>
      (function($){
        var Question = Backbone.Model.extend();

        var Questions = Backbone.Collection.extend({
          Model: Question,
          url: '#'
        });

        var questions = new Questions();

        var HomeView = Backbone.View.extend({
          
          el: 'body',

          initialize: function(){
            this.template = _.template($('#item-home').html());
            this.render();
          },

          render: function(){

            var template = this.template;
            var el = this.$el;

            el.empty();
            el.append(template());

            var listView = new ListView({collection:questions});
            
            $('.span4').append(listView.render().el);

            return this;
          }
        });

        var ListView = Backbone.View.extend({
          tagName: 'ul',
          className: 'nav nav-list',

          initialize: function(){
            this.collection.bind('all', _.bind(this.render, this));
            this.template = _.template($('#item-list').html());
          },

          render: function(){
            var template = this.template;
            var el = this.$el;

            $(".span4 ul").empty();
            this.collection.each(function(question){
              el.append(template(question.toJSON()));
            });
            
            el.append('<li><a href="#add">add new question</a></li>');
            el.append('<li><a href="#next">next question</a></li>');

            return this;
          }

        });

        window.AppRouter = Backbone.Router.extend({
          routes: {
            "":"home",
            "add":"add",
            "next":"next"
          },

          home: function(){
            console.log('home');
            new HomeView();
          },

          add: function(){
            console.log('add');
            new AddView();
          },

          next: function(){
            console.log('next');
            //TODO: define QuestionView.
            // new QuestionView();
          }
        })

      }(jQuery));

     $(document).ready(function(){
        new AppRouter();
        Backbone.history.start();
      });

    </script>

    <script type="text/template" id="item-home">
      <div class="container">
        <div class="page-header">
          <h1>BigO Quizlet</h1>
        </div>
        <div class="row">
          <div class="span4">
            <ul class="nav nav-list">
              <li><a href="#add">add new question</a></li>
              <li><a href="#next">next question</a></li>
            </ul>
          </div>
        </div>
      </div>
    </script>

    <script type="text/template" id="item-list">
      <li>a href="#"><%=name%></a></li>
    </script>

  </head>
  <body></body>
  </html>
